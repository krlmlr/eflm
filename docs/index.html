<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Efficient Fitting of Linear and Generalized Linear Models • eflm</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Efficient Fitting of Linear and Generalized Linear Models">
<meta property="og:description" content="Efficient Fitting of Linear and Generalized Linear Models by using
  just base R. As an alternative to lm() and glm(), this package provides elm()
  and eglm(), with a significant speedup when the number of 
  observations is larger than the number of parameters to estimate. The speed
 gains are obtained by reducing the NxP model matrix to a PxP matrix, and the 
 best computational performance is obtained when R is linked against OpenBLAS,
 Intel MKL or other optimized BLAS library. This implementation aims at being
 compatible with broom and sandwich packages for summary statistics and
 clustering by providing S3 methods.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">eflm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pachamaltese/eflm/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="efficient-fitting-of-linear-and-generalized-linear-models-">Efficient Fitting of Linear and Generalized Linear Models <img src="https://pacha.dev/eflm/hexicon.svg" width="150" align="right" alt="sticker"><a class="anchor" aria-label="anchor" href="#efficient-fitting-of-linear-and-generalized-linear-models-"></a>
</h1></div>
<!-- badges: start -->

<div class="section level2">
<h2 id="description">Description<a class="anchor" aria-label="anchor" href="#description"></a>
</h2>
<p>Efficient Fitting of Linear and Generalized Linear Models by using just base R. As an alternative to <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> and <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code>, this package provides <code><a href="reference/elm.html">elm()</a></code> and <code><a href="reference/eglm.html">eglm()</a></code>, with a significant speedup when the number of observations is larger than the number of parameters to estimate. The speed gains are obtained by reducing the NxP model matrix to a PxP matrix, and the best computational performance is obtained when R is linked against OpenBLAS, Intel MKL or other optimized BLAS library. This implementation aims at being compatible with ‘broom’ and ‘sandwich’ packages for summary statistics and clustering by providing S3 methods.</p>
</div>
<div class="section level2">
<h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a>
</h2>
<p>This package takes ideas from glm2, speedglm, fastglm, and fixest packages, but the implementations here shall keep the functions and outputs as closely as possible to the stats package, therefore making the functions provided here compatible with packages such as sandwich for robust estimation, even if that means to attenuate the speed gains.</p>
<p>The greatest strength of this package is testing. With more than 1600 (and counting) tests, we try to do exactly the same as lm/glm, even in edge cases, but faster.</p>
<p>The ultimate aim of the project is to produce a package that:</p>
<ul>
<li>Does exactly the same as lm and glm in less time</li>
<li>Is equally numerically stable as lm and glm</li>
<li>Depends only on base R, with no Rcpp or other calls</li>
<li>Uses R’s internal C code such as the <code>Cdqrls</code> function that the stats package uses for model fitting</li>
<li>Can be used in Shiny dashboard and contexts where you need fast model fitting</li>
<li>Is useful for memory consuming models</li>
<li>Allows model fitting with limited hardware</li>
</ul>
</div>
<div class="section level2">
<h2 id="minimal-working-example">Minimal working example<a class="anchor" aria-label="anchor" href="#minimal-working-example"></a>
</h2>
<div class="section level3">
<h3 id="stats-base-package">Stats (base) package<a class="anchor" aria-label="anchor" href="#stats-base-package"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">formula</span> <span class="op">&lt;-</span> <span class="st">"mpg ~ I(wt^2)"</span>
<span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">formula</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span>
<span class="co">#&gt; (Intercept)     I(wt^2) </span>
<span class="co">#&gt;  28.0510597  -0.7058275</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="eflm-package">Eflm package<a class="anchor" aria-label="anchor" href="#eflm-package"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/elm.html">elm</a></span><span class="op">(</span><span class="va">formula</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span>
<span class="co">#&gt; (Intercept)     I(wt^2) </span>
<span class="co">#&gt;  28.0510597  -0.7058275</span></code></pre></div>
<p>Please read the documentation for the full details.</p>
</div>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the released version of eflm from CRAN with:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"eflm"</span><span class="op">)</span></code></pre></div>
<p>And the development version with:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"pachamaltese/eflm"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="benchmarks">Benchmarks<a class="anchor" aria-label="anchor" href="#benchmarks"></a>
</h2>
<p>Let’s fit two computationally demanding models from <a href="https://pacha.dev/yotover/" class="external-link">Yotov, et al. (2016)</a>.</p>
<p>The dataset for the benchmark was also taken from Yotov, et al. and consists in a 28,152 x 8 data frame with 6 numeric and 2 categorical columns:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 28,152 x 8</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    year  trade   dist  cntg  lang  clny exp_year imp_year</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>   <span class="sc">&lt;</span>int<span class="sc">&gt;</span>  <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>  <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>int<span class="sc">&gt;</span> <span class="er">&lt;</span>int<span class="sc">&gt;</span> <span class="er">&lt;</span>int<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span>    <span class="er">&lt;</span>chr<span class="sc">&gt;</span>   </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span>  <span class="dv">1986</span>  <span class="fl">27.8</span>  <span class="fl">12045.</span>     <span class="dv">0</span>     <span class="dv">0</span>     <span class="dv">0</span> ARG1986  AUS1986 </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span>  <span class="dv">1986</span>   <span class="fl">3.56</span> <span class="fl">11751.</span>     <span class="dv">0</span>     <span class="dv">0</span>     <span class="dv">0</span> ARG1986  AUT1986 </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span>  <span class="dv">1986</span>  <span class="fl">96.1</span>  <span class="fl">11305.</span>     <span class="dv">0</span>     <span class="dv">0</span>     <span class="dv">0</span> ARG1986  BEL1986 </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span>  <span class="dv">1986</span>   <span class="fl">3.13</span> <span class="fl">12116.</span>     <span class="dv">0</span>     <span class="dv">0</span>     <span class="dv">0</span> ARG1986  BGR1986 </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a> <span class="dv">5</span>  <span class="dv">1986</span>  <span class="fl">52.7</span>   <span class="fl">1866.</span>     <span class="dv">1</span>     <span class="dv">1</span>     <span class="dv">0</span> ARG1986  BOL1986 </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a> <span class="dv">6</span>  <span class="dv">1986</span> <span class="fl">405.</span>    <span class="fl">2392.</span>     <span class="dv">1</span>     <span class="dv">0</span>     <span class="dv">0</span> ARG1986  BRA1986 </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a> <span class="dv">7</span>  <span class="dv">1986</span>  <span class="fl">48.3</span>   <span class="fl">9391.</span>     <span class="dv">0</span>     <span class="dv">0</span>     <span class="dv">0</span> ARG1986  CAN1986 </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a> <span class="dv">8</span>  <span class="dv">1986</span>  <span class="fl">23.6</span>  <span class="fl">11233.</span>     <span class="dv">0</span>     <span class="dv">0</span>     <span class="dv">0</span> ARG1986  CHE1986 </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a> <span class="dv">9</span>  <span class="dv">1986</span> <span class="fl">109.</span>    <span class="fl">1157.</span>     <span class="dv">1</span>     <span class="dv">1</span>     <span class="dv">0</span> ARG1986  CHL1986 </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span>  <span class="dv">1986</span> <span class="fl">161.</span>   <span class="fl">19110.</span>     <span class="dv">0</span>     <span class="dv">0</span>     <span class="dv">0</span> ARG1986  CHN1986 </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co"># … with 28,142 more rows</span></span></code></pre></div>
<p>The variables are:</p>
<ul>
<li>year: time of export/import flow</li>
<li>trade: bilateral trade</li>
<li>log_dist: log of distance</li>
<li>cntg: contiguity</li>
<li>lang: common language</li>
<li>clny: colonial relation</li>
<li>exp_year/imp_year: exporter/importer time fixed effects</li>
</ul>
<div class="section level3">
<h3 id="ols-estimation-controlling-for-multilateral-resistance-terms-with-fixed-effects">OLS estimation controlling for multilateral resistance terms with fixed effects<a class="anchor" aria-label="anchor" href="#ols-estimation-controlling-for-multilateral-resistance-terms-with-fixed-effects"></a>
</h3>
<p><em>This test was conducted on a 2 dedicated CPUs and 4GB of RAM DigitalOcean droplet.</em></p>
<p>The general equation for this model is:</p>
<p>By running regressions with cumulative subset of the data for 1986, …, 2006 (e.g. regress for 1986, then 1986 and 1990, …, then 1986 to 2006), we obtain the next fitting times and memory allocation depending on the design matrix dimensions:</p>
<p><img src="reference/figures/README-elm-benchmark-1.png" width="100%"><img src="reference/figures/README-elm-benchmark-2.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="ppml-estimation-controlling-for-multilateral-resistance-terms-with-fixed-effects">PPML estimation controlling for multilateral resistance terms with fixed effects:<a class="anchor" aria-label="anchor" href="#ppml-estimation-controlling-for-multilateral-resistance-terms-with-fixed-effects"></a>
</h3>
<p><em>This test was conducted on a 2 dedicated CPUs and 4GB of RAM DigitalOcean droplet.</em></p>
<p>The general equation for this model is:</p>
<p>By running regressions with cumulative subset of the data for 1986, …, 2006 (e.g. regress for 1986, then 1986 and 1990, …, then 1986 to 2006), we obtain the next fitting times depending on the design matrix dimensions:</p>
<p><img src="reference/figures/README-eglm-benchmark-1.png" width="100%"><img src="reference/figures/README-eglm-benchmark-2.png" width="100%"></p>
<!-- ## Progress list -->
<!-- ### Sandwich compatibility -->
<!-- - [x] estfun -->
<!-- - [x] bread -->
<!-- - [x] vcovCL -->
<!-- - [x] meatCL -->
<!-- - [x] vcovCL -->
<!-- - [x] vcovBS -->
<!-- - [ ] vcovHC -->
<!-- - [ ] meatHC -->
<!-- - [ ] vcovPC -->
<!-- - [ ] meatPC -->
<!-- - [ ] vcovPL -->
<!-- - [ ] meatPL -->
<!-- ### Broom compatibility -->
<!-- - [x] augment -->
<!-- - [x] tidy -->
<!-- ### CAR  -->
<!-- RESIDUALPLOTS -->
<!-- cooks.distance? -->
<!-- hatvalues? -->
<!-- influenceIndexPlot -->
<!-- influencePlot -->
<!-- QQpLOT -->
<!-- compareCoefs -->
<!-- ver fit4 <- update(fit, subset=!(rownames(datos2) %in% c("NY","SD","TX","NV","CT"))  ) -->
</div>
</div>
<div class="section level2">
<h2 id="acknowledgements">Acknowledgements<a class="anchor" aria-label="anchor" href="#acknowledgements"></a>
</h2>
<p><em>“If I have seen further it is by standing on the shoulders of Giants.”</em></p>
<p>The original generalized linear model implementation via iteratively reweighted least squares for any family was written in R by Simon Davies in Dec, 1995. This implementation was later improved by Thomas Lumley back in Apr, 1997, and then other developers. In 2021, their work was adapted by me, Mauricio ‘Pachá’ Vargas Sepúlveda, for large datasets.</p>
<p>This work got very well received feedback from:</p>
<ul>
<li>Constanza Prado</li>
<li>Alexey Kravchenko</li>
<li>Yoto Yotov</li>
<li>Joshua Kunst</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=eflm" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/pachamaltese/eflm/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/pachamaltese/eflm/issues/" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>Apache License (&gt;= 2)</small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing eflm</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Mauricio Vargas <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-1017-7574" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li> The United Nations <br><small class="roles"> Data contributor, copyright holder, funder </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://www.repostatus.org/#active" class="external-link"><img src="https://www.repostatus.org/badges/latest/active.svg" alt="Project Status: Active – The project has reached a stable, usable state and is being actively developed."></a></li>
<li><a href="https://www.tidyverse.org/lifecycle/#stable" class="external-link"><img src="https://img.shields.io/badge/lifecycle-stable-brightgreen.svg" alt="Lifecycle: stable"></a></li>
<li><a href="https://cran.r-project.org/package=eflm" class="external-link"><img src="https://www.r-pkg.org/badges/version/gravity" alt="CRAN status"></a></li>
<li><a href="https://codecov.io/gh/pachamaltese/eflm" class="external-link"><img src="https://codecov.io/gh/pachamaltese/eflm/branch/main/graph/badge.svg?token=XI59cmGd15" alt="codecov"></a></li>
<li><a href="https://github.com/pachamaltese/eflm/actions" class="external-link"><img src="https://github.com/pachamaltese/eflm/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Mauricio Vargas, The United Nations.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.9000.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
